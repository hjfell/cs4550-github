<!doctype html>
<html>
<head>
    <title>My Audio Tests 0</title>
    <script>	
    // from http://www.html5rocks.com/
    
    var context;
	window.addEventListener('load', init, false);
	function init() {
  		try {
    		context = new webkitAudioContext();
  		}
  		catch(e) {
    		alert('Web Audio API is not supported in this browser');
  		}
	}
 	var mySoundBuffer = null;
 	

	function loadSound(url) {
		var request = new XMLHttpRequest();
		request.open('GET', url, true);
		request.responseType = 'arraybuffer';

		// Decode asynchronously
		request.onload = function() {
			context.decodeAudioData(request.response, function(buffer) {
				mySoundBuffer = buffer;
			});
		}
		request.send();
	}
	
	function playSound(buffer) {
  		var source = context.createBufferSource(); // creates a sound source
  		source.buffer = buffer;                    // tell the source which sound to play
  		source.connect(context.destination);       // connect the source to the context's destination (the speakers)
  		source.noteOn(0);                          // play the source now
	}
	
	function drawIt(buffer) {
		var canvas = document.getElementById('my_canvas');
        if (canvas.getContext){
          var ctx = canvas.getContext('2d');
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          bbb = buffer.getChannelData(0);
          ctx.beginPath();
                  
          var start = 0;
          ctx.moveTo(0,100+100*bbb[start]);
          var step = Math.round((mySoundBuffer.length)/1000);
 
	      for (i = start; i < start+mySoundBuffer.length; i=i+1) {
          	ctx.lineTo(i/step, 100+100*bbb[i]);        
	      }
          ctx.stroke();
        }
	}
	
	</script>
</head>
<body onload="init();">
<button type="button" onclick="loadSound('../sounds/jd_3921.wav');">Load Babble</button>
<button type="button" onclick="loadSound('../sounds/numbersF.wav');">Load Numbers</button>

<button type="button" onclick="playSound(mySoundBuffer);">Play Sound</button>
<button type="button" onclick="document.write(mySoundBuffer.length);">Wave Buffer Length</button>
<button type="button" onclick="drawIt(mySoundBuffer);">Draw It</button>
<br />
<canvas id="my_canvas" width="1000" height="200"  style="border: 1px solid black;"></canvas>

</body>
</html>